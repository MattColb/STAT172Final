geom_bar(stat = "identity", position = "stack") +
coord_flip() +
scale_fill_brewer(palette = "Dark2", labels = c("Senior Size", "Remaining")) +
labs(
title = "Elderly Population",
x = "",
y = "Sample Size",
fill = "Legend"
) +
theme_minimal()
elderly_summary$Metric <- factor(elderly_summary$Metric, levels = c("Count", "Remaining"))
# Create the stacked bar chart
ggplot(data = elderly_summary, aes(x = Category, y = Value, fill = Metric)) +
geom_bar(stat = "identity", position = "stack") +
coord_flip() +
scale_fill_brewer(palette = "Dark2", labels = c("Senior Size", "Remaining")) +
labs(
title = "Elderly Population",
x = "",
y = "Sample Size",
fill = "Legend"
) +
theme_minimal()
elderly_summary <- data.frame(
Category = c("Households with a senior",
"Households with only seniors",
"Households with one senior"),
Count = c(
sum(summary_by_PUMA$has_senior),
sum(summary_by_PUMA$only_senior),
sum(summary_by_PUMA$one_senior)
))
# Calculate proportions relative to the total sample size
total_sample_size <- sum(summary_by_PUMA$sample_size)
elderly_summary <- elderly_summary %>%
mutate(
Proportion = (Count / total_sample_size) * 100, # Percentage of total sample size
Remaining = total_sample_size - Count         # Remaining households in the sample size
) %>%
pivot_longer(
cols = c("Count", "Remaining"),
names_to = "Metric",
values_to = "Value"
)
elderly_summary$Metric <- factor(elderly_summary$Metric, levels = c("Count", "Remaining"))
# Create the stacked bar chart
ggplot(data = elderly_summary, aes(x = Category, y = Value, fill = Metric)) +
geom_bar(stat = "identity", position = "stack") +
coord_flip() +
scale_fill_brewer(palette = "Dark2", labels = c("Senior Size", "Remaining")) +
labs(
title = "Elderly Population",
x = "",
y = "Sample Size",
fill = "Legend"
) +
theme_minimal()
# Calculate proportions relative to the total sample size
total_sample_size <- sum(summary_by_PUMA$sample_size)
elderly_summary <- elderly_summary %>%
mutate(
Proportion = (Count / total_sample_size) * 100, # Percentage of total sample size
Remaining = total_sample_size - Count         # Remaining households in the sample size
) %>%
pivot_longer(
cols = c("Count", "Remaining"),
names_to = "Metric",
values_to = "Value"
)
elderly_summary <- data.frame(
Category = c("Households with a senior",
"Households with only seniors",
"Households with one senior"),
Count = c(
sum(summary_by_PUMA$has_senior),
sum(summary_by_PUMA$only_senior),
sum(summary_by_PUMA$one_senior)
))
# Calculate proportions relative to the total sample size
total_sample_size <- sum(summary_by_PUMA$sample_size)
elderly_summary <- elderly_summary %>%
mutate(
Proportion = (Count / total_sample_size) * 100, # Percentage of total sample size
Remaining = total_sample_size - Count         # Remaining households in the sample size
) %>%
pivot_longer(
cols = c("Count", "Remaining"),
names_to = "Metric",
values_to = "Value"
)
elderly_summary$Metric <- factor(elderly_summary$Metric, levels = c("Count", "Remaining"))
# Create the stacked bar chart
ggplot(data = elderly_summary, aes(x = Category, y = Value, fill = Metric)) +
geom_bar(stat = "identity", position = "stack") +
coord_flip() +
scale_fill_brewer(palette = "Dark2", labels = c("Senior Size", "")) +
labs(
title = "Elderly Population",
x = "",
y = "Sample Size",
fill = "Legend"
) +
theme_minimal()
#How does this adjust with the weights
summary_by_PUMA <- acs_predicted_only_seniors %>% group_by(PUMA = as.factor(PUMA)) %>%
summarise(
sample_size = sum(hhsize),
proportion_on_assistance = weighted.mean(fswrouty_probs, weight),
only_senior = sum(ifelse(elderly == hhsize, 1, 0)), #only seniors in the house
has_senior = sum(ifelse(elderly > 0, 1, 0)), #house has senior
one_senior = sum(ifelse(elderly == hhsize & hhsize == 1, 1, 0)) #only 1 senior in the house
) %>% as.data.frame() %>% arrange(desc(proportion_on_assistance))
elderly_summary <- data.frame(
Category = c("Households with a senior",
"Households with only seniors",
"Households with one senior"),
Count = c(
sum(summary_by_PUMA$has_senior),
sum(summary_by_PUMA$only_senior),
sum(summary_by_PUMA$one_senior)
))
# Calculate proportions relative to the total sample size
total_sample_size <- sum(summary_by_PUMA$sample_size)
elderly_summary <- elderly_summary %>%
mutate(
Proportion = (Count / total_sample_size) * 100, # Percentage of total sample size
Remaining = total_sample_size - Count         # Remaining households in the sample size
) %>%
pivot_longer(
cols = c("Count", "Remaining"),
names_to = "Metric",
values_to = "Value"
)
elderly_summary$Metric <- factor(elderly_summary$Metric, levels = c("Count", "Remaining"))
# Create the stacked bar chart
ggplot(data = elderly_summary, aes(x = Category, y = Value, fill = Metric)) +
geom_bar(stat = "identity", position = "stack") +
coord_flip() +
scale_fill_brewer(palette = "Dark2", labels = c("Senior Size", "")) +
labs(
title = "Elderly Population",
x = "",
y = "Sample Size"
) +
theme_minimal()
elderly_summary <- data.frame(
Category = c("Households with a senior",
"Households with only seniors",
"Households with one senior"),
Count = c(
sum(summary_by_PUMA$has_senior),
sum(summary_by_PUMA$only_senior),
sum(summary_by_PUMA$one_senior)
))
# Calculate proportions relative to the total sample size
total_sample_size <- nrow(acs_data)
elderly_summary <- elderly_summary %>%
mutate(
Proportion = (Count / total_sample_size) * 100, # Percentage of total sample size
Remaining = total_sample_size - Count         # Remaining households in the sample size
) %>%
pivot_longer(
cols = c("Count", "Remaining"),
names_to = "Metric",
values_to = "Value"
)
elderly_summary$Metric <- factor(elderly_summary$Metric, levels = c("Count", "Remaining"))
# Create the stacked bar chart
ggplot(data = elderly_summary, aes(x = Category, y = Value, fill = Metric)) +
geom_bar(stat = "identity", position = "stack") +
coord_flip() +
scale_fill_brewer(palette = "Dark2", labels = c("Senior Size", "")) +
labs(
title = "Elderly Population",
x = "",
y = "Sample Size"
) +
theme_minimal()
elderly_summary
elderly_summary <- data.frame(
Category = c("Households with a senior",
"Households with only seniors",
"Households with one senior"),
Count = c(
sum(summary_by_PUMA$has_senior),
sum(summary_by_PUMA$only_senior),
sum(summary_by_PUMA$one_senior)
))
elderly_summary
elderly_summary <- data.frame(
Category = c("Households with a senior",
"Households with only seniors",
"Households with one senior"),
Count = c(
sum(summary_by_PUMA$has_senior),
sum(summary_by_PUMA$only_senior),
sum(summary_by_PUMA$one_senior)/nrow(acs_data)
))
elderly_summary
total_sample_size <- nrow(acs_data)
elderly_summary <- data.frame(
Category = c("Households with a senior",
"Households with a senior",
"Households with only seniors",
"Households with one senior"),
Count = c(
sum(summary_by_PUMA$has_senior),
total_sample_size - sum(summary_by_PUMA$has_senior),
sum(summary_by_PUMA$only_senior),
sum(summary_by_PUMA$one_senior)
),
Type = c("Senior", "Remaining")
)
# Calculate proportions relative to the total sample size
elderly_summary <- elderly_summary %>%
mutate(
Proportion = (Count / total_sample_size) * 100, # Percentage of total sample size
Remaining = total_sample_size - Count         # Remaining households in the sample size
) %>%
pivot_longer(
cols = c("Count", "Remaining"),
names_to = "Metric",
values_to = "Value"
)
elderly_summary$Metric <- factor(elderly_summary$Metric, levels = c("Count", "Remaining"))
# Create the stacked bar chart
ggplot(data = elderly_summary, aes(x = Category, y = Value, fill = Metric)) +
geom_bar(stat = "identity", position = "stack") +
coord_flip() +
scale_fill_brewer(palette = "Dark2", labels = c("Senior Size", "")) +
labs(
title = "Elderly Population",
x = "",
y = "Sample Size"
) +
theme_minimal()
elderly_summary
total_sample_size <- nrow(acs_data)
elderly_summary <- data.frame(
Category = c("Households with a senior",
"Households with a senior",
"Households with only seniors",
"Households with one senior"),
Count = c(
sum(summary_by_PUMA$has_senior),
total_sample_size - sum(summary_by_PUMA$has_senior),
sum(summary_by_PUMA$only_senior),
sum(summary_by_PUMA$one_senior)
),
Type = c("Senior", "Remaining")
)
elderly_summary
nrow(acs_data)
elderly_summary <- data.frame(
Category = c("Households with a senior",
"Households with a senior",
"Households with only seniors",
"Households with only seniors",
"Households with one seniors",
"Households with one senior"),
Count = c(
sum(summary_by_PUMA$has_senior),
total_sample_size - sum(summary_by_PUMA$has_senior),
sum(summary_by_PUMA$only_senior),
total_sample_size - sum(summary_by_PUMA$only_senior),
sum(summary_by_PUMA$one_senior),
total_sample_size - sum(summary_by_PUMA$one_senior)
),
Type = c("Senior", "Remaining")
)
elderly_summary
ggplot(data=elderly_summary) +
geom_bar(aes(x=Count, y=Category))
ggplot(data=elderly_summary) +
geom_bar(aes(x=Count))
ggplot(data=elderly_summary) +
geom_bar(aes(x=Count, fill=Type))
# Create the stacked bar chart
ggplot(elderly_summary, aes(x = Category, y = Count, fill = Type)) +
geom_bar(stat = "identity", position = "stack") +
coord_flip() +
labs(
title = "Household Composition with Senior Members",
x = "Category",
y = "Count",
fill = "Type"
) +
scale_fill_brewer(palette = "Set3") +
theme_minimal()
elderly_summary <- data.frame(
Category = c("Households with seniors",
"Households with seniors",
"Households with only seniors",
"Households with only seniors",
"Households with only one seniors",
"Households with only one seniors"),
Count = c(
sum(summary_by_PUMA$has_senior),
total_sample_size - sum(summary_by_PUMA$has_senior),
sum(summary_by_PUMA$only_senior),
total_sample_size - sum(summary_by_PUMA$only_senior),
sum(summary_by_PUMA$one_senior),
total_sample_size - sum(summary_by_PUMA$one_senior)
),
Type = c("Senior", "Remaining")
)
# Create the stacked bar chart
ggplot(elderly_summary, aes(x = Category, y = Count, fill = Type)) +
geom_bar(stat = "identity", position = "stack") +
coord_flip() +
labs(
title = "Household Composition with Senior Members",
x = "Category",
y = "Count",
fill = "Type"
) +
scale_fill_brewer(palette = "Set3") +
theme_minimal()
total_sample_size <- nrow(acs_data)
elderly_summary <- data.frame(
Category = c("Households with seniors",
"Households with seniors",
"Households with only seniors",
"Households with only seniors",
"Households with only one seniors",
"Households with only one seniors"),
Count = c(
sum(summary_by_PUMA$has_senior),
total_sample_size - sum(summary_by_PUMA$has_senior),
sum(summary_by_PUMA$only_senior),
total_sample_size - sum(summary_by_PUMA$only_senior),
sum(summary_by_PUMA$one_senior),
total_sample_size - sum(summary_by_PUMA$one_senior)
),
Type = c("Senior", "Remaining")
)
# Create the stacked bar chart
ggplot(elderly_summary, aes(x = Category, y = Count, fill = Type)) +
geom_bar(stat = "identity", position = "stack") +
coord_flip() +
labs(
title = "Household Composition with Senior Members",
x = "Category",
y = "Count",
fill = "Type"
) +
scale_fill_brewer(palette = "Dark2") +
theme_minimal()
# Create the stacked bar chart
ggplot(elderly_summary, aes(x = Category, y = Count, fill = Type)) +
geom_bar(stat = "identity", position = "stack") +
coord_flip() +
labs(
title = "Household Composition with Senior Members",
x = "Category",
y = "Sample Size",
fill = "Type"
) +
scale_fill_brewer(palette = "Dark2") +
theme_minimal()
test_preds <- test.df %>%
mutate (
ridge_prob = predict(ridge_model, x_test, type = "response"))
test_preds
ridge_rocCurve <- roc(response = as.factor(test_preds$FSWROUTY_bin),
predictor = test_preds$ridge_prob,
levels = c("0", "1"))
plot(ridge_rocCurve, print.thres=TRUE, print.auc=TRUE)
ridge_model %>% coef()
exp(elderly)
exp(-.308)
weighted.mean(acs_predicted_only_seniors$fswrouty_probs, acs_predicted_only_seniors$weight)
cps_data
table(cps_data$FSWROUTY)
923/(1760+923)
ggplot(data = senior_data) +
geom_sf(aes(fill = seniors_with_fswrouty)) +
scale_fill_viridis_c(option = "plasma") +  # Adjust color palette as needed
theme_minimal() +
labs(title = "Predicted Seniors w Food Anxiety by PUMA",
fill = "Predicted number\nof Seniors\nwith Food Anxiety")
senior_data <- read.csv("./data/iowa_seniors_by_puma.csv")
senior_data <- senior_data %>% mutate("PUMA" = as.character(GEOID))
senior_data <- map_data %>% left_join(senior_data, by="PUMA")
senior_data <- senior_data %>% mutate(
seniors_with_fswrouty = floor(proportion_on_assistance*senior_population)
)
senior_data <- read.csv("./data/iowa_seniors_by_puma.csv")
senior_data <- senior_data %>% mutate("PUMA" = as.character(GEOID))
senior_data <- map_data %>% left_join(senior_data, by="PUMA")
senior_data <- senior_data %>% mutate(
seniors_with_fswrouty = floor(proportion_on_assistance*senior_population)
)
senior_data
write.csv(acs_predicted_only_seniors, "./data/fswrouty_prediction.csv")
source("C:/Users/mattc/Desktop/FA24/STAT172Final/code/fsstamp_analysis.R")
rm(list=ls())
library(ggplot2)
fswrouty <- read.csv("./data/fswrouty_prediction.csv")
fsstmp <- read.csv("./data/fsstmp_prediction.csv")
head(fsstmp)
length(unique(fsstmp$serialno))
fsstmp %>%  left_join(fswrouty, by="serialno")
merged <- fsstmp %>%  left_join(fswrouty, by="serialno") %>%
select("serialno", "PUMA.x", "fswrouty_probs", "fsstmp_probabilities", "hhsize.x", "weight.x", "elderly.x")
head(merged)
apply(merged$fsstmp_probabilities, 2, function(x)(x - mean(x))/sd(x))
apply(merged, 2, function(x)(x - mean(x))/sd(x))
apply(merged, 2, function(x)(x - mean(x))/sd(x))["fswrouty_probs", "fsstmp_probabilities"]
apply(merged, 2, function(x)(x - mean(x))/sd(x))[,c("fswrouty_probs", "fsstmp_probabilities")]
merged_standard <- merged
merged_standard[,c("fswrouty_probs", "fsstmp_probabilities")] <- apply(merged, 2, function(x)(x - mean(x))/sd(x))[,c("fswrouty_probs", "fsstmp_probabilities")]
merged_standard
merged_standard %>% mutate(
sum_of_z_scores = mean(fswrouty_probs, fsstmp_probabilities)
)
merged_standard %>% mutate(
sum_of_z_scores = (fswrouty_probs + fsstmp_probabilities)/2
)
ggplot(data=merged_standard) + geom_histogram(aes(x = mean_of_z_scores))
ggplot(data=merged_standard) + geom_histogram(aes(x = sum_of_z_scores))
merged_standard <- merged_standard %>% mutate(
mean_of_z_scores = (fswrouty_probs + fsstmp_probabilities)/2
)
ggplot(data=merged_standard) + geom_histogram(aes(x = mean_of_z_scores))
summary_by_PUMA <- merged_standard %>% group_by(PUMA = as.factor(PUMA)) %>%
summarise(
sample_size = sum(hhsize),
food_insecurity_metric = weighted.mean(mean_of_z_scores, weight),
) %>% as.data.frame() %>% arrange(desc(food_insecurity_metric))
merged_standard
colnames(merged_standard)
merged <- fsstmp %>%  left_join(fswrouty, by="serialno") %>%
select("serialno", "PUMA.x", "fswrouty_probs", "fsstmp_probabilities", "hhsize.x", "weight.x", "elderly.x")
names(merged)[names(merged) == 'PUMA.x'] <- 'PUMA'
names(merged)[names(merged) == 'hhsize.x'] <- 'hhsize'
names(merged)[names(merged) == 'weight.x'] <- 'weight'
names(merged)[names(merged) == 'elderly.x'] <- 'elderly'
merged_standard <- merged
merged_standard[,c("fswrouty_probs", "fsstmp_probabilities")] <- apply(merged, 2, function(x)(x - mean(x))/sd(x))[,c("fswrouty_probs", "fsstmp_probabilities")]
merged_standard <- merged_standard %>% mutate(
mean_of_z_scores = (fswrouty_probs + fsstmp_probabilities)/2
)
summary_by_PUMA <- merged_standard %>% group_by(PUMA = as.factor(PUMA)) %>%
summarise(
sample_size = sum(hhsize),
food_insecurity_metric = weighted.mean(mean_of_z_scores, weight),
) %>% as.data.frame() %>% arrange(desc(food_insecurity_metric))
summary_by_PUMA
summary_by_PUMA <- merged_standard %>% group_by(PUMA = as.factor(PUMA)) %>%
summarise(
sample_size = sum(hhsize),
food_insecurity_metric = weighted.mean(mean_of_z_scores, weight),
) %>% as.data.frame() %>% arrange(desc(food_insecurity_metric))
sf_data <- st_read("./data/tl_2023_19_puma20/tl_2023_19_puma20.shp")
colnames(sf_data)[colnames(sf_data) == "GEOID20"] = "PUMA"
map_data <- sf_data %>%
left_join(summary_by_PUMA, by = "PUMA")
#Proportion of seniors that are on SNAP/Food Stamps
ggplot(data = map_data) +
geom_sf(aes(fill = food_insecurity_metric)) +
scale_fill_viridis_c(option = "plasma") +  # Adjust color palette as needed
theme_minimal() +
labs(title = "Proportion of Households with Seniors on SNAP/Food Stamps",
fill = "Proportion on\nFood Stamps/SNAP")
ggsave("figures/propotion_of_seniors_predicted.png", width=6, height=5)
source("C:/Users/mattc/Desktop/FA24/STAT172Final/code/combining_predictions.R")
source("C:/Users/mattc/Desktop/FA24/STAT172Final/code/combining_predictions.R")
#Proportion of seniors that are on SNAP/Food Stamps
ggplot(data = map_data) +
geom_sf(aes(fill = food_insecurity_metric)) +
scale_fill_viridis_c(option = "plasma") +  # Adjust color palette as needed
theme_minimal() +
labs(title = "Proportion of Households with Seniors on SNAP/Food Stamps",
fill = "Proportion on\nFood Stamps/SNAP")
ggplot(data=merged_standard) + geom_histogram(aes(x=sum_of_z_scores))
#Proportion of seniors that are on SNAP/Food Stamps
ggplot(data = map_data) +
geom_sf(aes(fill = food_insecurity_metric)) +
scale_fill_viridis_c(option = "plasma") +  # Adjust color palette as needed
theme_minimal() +
labs(title = "Proportion of Households with Seniors on SNAP/Food Stamps",
fill = "Proportion on\nFood Stamps/SNAP")
source("C:/Users/mattc/Desktop/FA24/STAT172Final/code/combining_predictions.R")
source("C:/Users/mattc/Desktop/FA24/STAT172Final/code/combining_predictions.R")
#Proportion of seniors that are on SNAP/Food Stamps
ggplot(data = map_data) +
geom_sf(aes(fill = food_insecurity_metric)) +
scale_fill_viridis_c(option = "plasma") +  # Adjust color palette as needed
theme_minimal() +
labs(title = "Proportion of Households with Seniors on SNAP/Food Stamps",
fill = "Proportion on\nFood Stamps/SNAP")
source("C:/Users/mattc/Desktop/FA24/STAT172Final/code/combining_predictions.R")
source("C:/Users/mattc/Desktop/FA24/STAT172Final/code/combining_predictions.R")
?haven
?st_read
library(sp)
library(sf)
source("C:/Users/mattc/Desktop/FA24/STAT172Final/code/combining_predictions.R")
ggplot(data = senior_data) +
geom_sf(aes(fill = seniors_on_fsstmp)) +
scale_fill_viridis_c(option = "plasma") +  # Adjust color palette as needed
theme_minimal() +
labs(title = "Predicted Number of Seniors on SNAP by PUMA",
fill = "Predicted number\nof Seniors\non SNAP")
source("C:/Users/mattc/Desktop/FA24/STAT172Final/code/combining_predictions.R")
ggplot(data = senior_data) +
geom_sf(aes(fill = seniors_on_fsstmp)) +
scale_fill_viridis_c(option = "plasma") +  # Adjust color palette as needed
theme_minimal() +
labs(title = "Predicted Number of Seniors on SNAP by PUMA",
fill = "Predicted number\nof Seniors\non SNAP")
