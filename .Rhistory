install.packages("ggthemes")
library(tidyverse)
library(ggthemes)
library(logistf)
library(glmnet)
library(haven)
cps <- read.csv("./data/cps_00005.csv")
head(cps[,c("CPSID","PERNUM", "FSSTATUS", "FSSTATUSMD", "RACE","EDUC")]) %>% kable
head(cps[,c("CPSID","PERNUM", "FSSTATUS", "FSSTATUSMD", "RACE","EDUC")])
map_chr(cps, -attr(.x, "label")) %>%
bind_cols(names=names(cps, question = .) %>%
rownames_to_columns(var="Variable Name")) %>% kable
map_chr(cps, -attr(.x, "label")) %>%
bind_cols(names=names(cps, question = .) %>%
rownames_to_columns(var="Variable Name"))
map_chr(cps, ~attr(.x, "label")) %>%
bind_cols(names=names(cps, question = .) %>%
rownames_to_columns(var="Variable Name"))
map_chr(cps, ~attr(.x, "label")) %>%
bind_cols(names=names(cps), question = .) %>%
rownames_to_columns(var="Variable Name"))
map_chr(cps, ~attr(.x, "label")) %>%
bind_cols(names=names(cps), question = .) %>%
rownames_to_columns(var="Variable Name")
map_chr(cps, ~attr(.x, "label")) %>%
bind_cols(names=names(cps), question = .)
summary(cps)
cps <- cps %>% mutate(SEX = SEX-1,
CHILD = ifelse(AGE < 18, 1, 0),
ELDERLY = ifelse(AGE > 64, 1, 0),
BLACK = ifelse(RACE==200, 1, 0),
HISPANIC = ifelse(HISPAN>0,1,0),
EDUC = as.integer(EDUC %in% c(91 ,92, 111, 123, 124, 125)),
EMP = as.integer(EMPSTAT%in% c(1,10,12)),
MARRIED = as.integer(MARST %in% c(1,2)),
DIFF = ifelse(DIFFANY==2,1,0),
COUNT = as.factor(COUNTY)
)
library(knitr)
head(cps[,c("CPSID","PERNUM", "FSSTATUS", "FSSTATUSMD", "RACE","EDUC")]) %>% kable
map_chr(cps, ~attr(.x, "label")) %>%
bind_cols(names=names(cps), question = .) %>%
rownames_to_columns(var="Variable Name") %>% kable
library(tibble)
map_chr(cps, ~attr(.x, "label")) %>%
bind_cols(names=names(cps), question = .) %>%
rownames_to_columns(var="Variable Name") %>% kable
map_chr(cps, ~attr(.x, "label")) %>%
bind_cols(names=names(cps), question = .) %>%
rownames_to_column(var="Variable Name") %>% kable
cps_data <- cps %>% group_by(CPSID=as.factor(CPSID)) %>%
summarise(
COUNTY = first(COUNTY),
weight = first(HWTFINL),
hhsize = n(),
FSTOTXPNC_perpers = FSTOTXPNC/hhsize,
FSSTATUS = first(FSSTATUS),
FSSTATUSMD = first(FSSTATUSMD),
FSFOODS = first(FSFOODS),
FSWROUTY = first(FSWROUTY),
FSBAL = first(FSBAL),
first(FSRAWSCRA),
FSTOTXPNC = first(FSTOTXPNC),
FSSTATUS = first(FSSTATUS),
female = sum(SEX),
hispanic = sum(HISPANIC),
black = sum(BLACK),
kids = sum(CHILD),
elderly = sum(ELDERLY),
education = SUM(EDUC),
married = sum(MARRIED)
) %>% ungroup()
cps_data <- cps %>% group_by(CPSID=as.factor(CPSID)) %>%
summarise(
COUNTY = first(COUNTY),
weight = first(HWTFINL),
hhsize = n(),
FSTOTXPNC_perpers = FSTOTXPNC/hhsize,
FSSTATUS = first(FSSTATUS),
FSSTATUSMD = first(FSSTATUSMD),
FSFOODS = first(FSFOODS),
FSWROUTY = first(FSWROUTY),
FSBAL = first(FSBAL),
first(FSRAWSCRA),
FSTOTXPNC = first(FSTOTXPNC),
FSSTATUS = first(FSSTATUS),
female = sum(SEX),
hispanic = sum(HISPANIC),
black = sum(BLACK),
kids = sum(CHILD),
elderly = sum(ELDERLY),
education = sum(EDUC),
married = sum(MARRIED)
) %>% ungroup()
head(cps_data)
cps_data <- cps %>% group_by(CPSID=as.factor(CPSID)) %>%
summarise(
COUNTY = first(COUNTY),
weight = first(HWTFINL),
hhsize = n(),
FSTOTXPNC_perpers = FSTOTXPNC/hhsize,
FSSTATUS = first(FSSTATUS),
FSSTATUSMD = first(FSSTATUSMD),
FSFOODS = first(FSFOODS),
FSWROUTY = first(FSWROUTY),
FSBAL = first(FSBAL),
first(FSRAWSCRA),
FSTOTXPNC = first(FSTOTXPNC),
FSSTATUS = first(FSSTATUS),
female = sum(SEX),
hispanic = sum(HISPANIC),
black = sum(BLACK),
kids = sum(CHILD),
elderly = sum(ELDERLY),
education = sum(EDUC),
married = sum(MARRIED)
)
cps_data <- cps %>% group_by(CPSID=as.factor(CPSID)) %>%
reframe(
COUNTY = first(COUNTY),
weight = first(HWTFINL),
hhsize = n(),
FSTOTXPNC_perpers = FSTOTXPNC/hhsize,
FSSTATUS = first(FSSTATUS),
FSSTATUSMD = first(FSSTATUSMD),
FSFOODS = first(FSFOODS),
FSWROUTY = first(FSWROUTY),
FSBAL = first(FSBAL),
first(FSRAWSCRA),
FSTOTXPNC = first(FSTOTXPNC),
FSSTATUS = first(FSSTATUS),
female = sum(SEX),
hispanic = sum(HISPANIC),
black = sum(BLACK),
kids = sum(CHILD),
elderly = sum(ELDERLY),
education = sum(EDUC),
married = sum(MARRIED)
)
head(cps_data)
cps_data <- cps %>% group_by(CPSID=as.factor(CPSID)) %>%
reframe(
COUNTY = first(COUNTY),
weight = first(HWTFINL),
hhsize = n(),
FSTOTXPNC_perpers = FSTOTXPNC/hhsize,
FSSTATUS = first(FSSTATUS),
FSSTATUSMD = first(FSSTATUSMD),
FSFOODS = first(FSFOODS),
FSWROUTY = first(FSWROUTY),
FSBAL = first(FSBAL),
first(FSRAWSCRA),
FSTOTXPNC = first(FSTOTXPNC),
FSSTATUS = first(FSSTATUS),
female = sum(SEX),
hispanic = sum(HISPANIC),
black = sum(BLACK),
kids = sum(CHILD),
elderly = sum(ELDERLY),
education = sum(EDUC),
married = sum(MARRIED)
) %>% ungroup()
cps_data <- cps_data %>%
mutate(FSSTATUS = ifelse(FSSTATUS %in% c(98,99), NA, FSSTATUS),
FSSTATUSMD = ifelse(FSSTATUSMD %in% c(98,99), NA, FSSTATUSMD),
FSFOODS = ifelse(FSFOODS %in% c(98,99), NA, FSFOODS),
FSWROUTY = ifelse(FSWROUTY %in% c(96,97,98,99), NA, FSWROUTY),
FSBAL = ifelse(FSBAL %in% c(96,97,98,99), NA, FSBAL),
FSRAWSCRA = ifelse(FSRAWSCRA %in% c(98,99), NA, FSRAWSCRA),
FSTOTXPNC = ifelse(FSTOTXPNC %in% c(999), NA, FSTOTXPNC)) %>%
mutate(FSSTATUS = ifelse(FSSTATUS > 1, 1, 0),
FSSTATUSMD = ifelse(FSSTATUSMD >1, 1, 0),
FSFOOD = ifelse(FSFOODS > 1, 1, 0),
FSWROUTY = ifelse(FSWROUTY > 1, 1, 0),
FSBAL = ifelse(FSBAL > 1, 1, 0),
FSRAWSCRA = ifelse(FSRAWSCRA >1, 1, 0)
)
#Not currently grouping properly
cps_data <- cps %>% group_by(CPSID=as.factor(CPSID)) %>%
summarise(
COUNTY = first(COUNTY),
weight = first(HWTFINL),
hhsize = n(),
FSTOTXPNC_perpers = FSTOTXPNC/hhsize,
FSSTATUS = first(FSSTATUS),
FSSTATUSMD = first(FSSTATUSMD),
FSFOODS = first(FSFOODS),
FSWROUTY = first(FSWROUTY),
FSBAL = first(FSBAL),
FSRAWSCRA = first(FSRAWSCRA),
FSTOTXPNC = first(FSTOTXPNC),
FSSTATUS = first(FSSTATUS),
female = sum(SEX),
hispanic = sum(HISPANIC),
black = sum(BLACK),
kids = sum(CHILD),
elderly = sum(ELDERLY),
education = sum(EDUC),
married = sum(MARRIED)
) %>% ungroup()
#Not currently grouping properly
cps_data <- cps %>% group_by(CPSID=as.factor(CPSID)) %>%
reframe(
COUNTY = first(COUNTY),
weight = first(HWTFINL),
hhsize = n(),
FSTOTXPNC_perpers = first(FSTOTXPNC)/hhsize,
FSSTATUS = first(FSSTATUS),
FSSTATUSMD = first(FSSTATUSMD),
FSFOODS = first(FSFOODS),
FSWROUTY = first(FSWROUTY),
FSBAL = first(FSBAL),
FSRAWSCRA = first(FSRAWSCRA),
FSTOTXPNC = first(FSTOTXPNC),
FSSTATUS = first(FSSTATUS),
female = sum(SEX),
hispanic = sum(HISPANIC),
black = sum(BLACK),
kids = sum(CHILD),
elderly = sum(ELDERLY),
education = sum(EDUC),
married = sum(MARRIED)
) %>% ungroup()
#Not currently grouping properly
cps_data <- cps %>% group_by(CPSID=as.factor(CPSID)) %>%
reframe(
COUNTY = first(COUNTY),
weight = first(HWTFINL),
hhsize = n(),
FSTOTXPNC_perpers = FSTOTXPNC/hhsize,
FSSTATUS = first(FSSTATUS),
FSSTATUSMD = first(FSSTATUSMD),
FSFOODS = first(FSFOODS),
FSWROUTY = first(FSWROUTY),
FSBAL = first(FSBAL),
FSRAWSCRA = first(FSRAWSCRA),
FSTOTXPNC = first(FSTOTXPNC),
FSSTATUS = first(FSSTATUS),
female = sum(SEX),
hispanic = sum(HISPANIC),
black = sum(BLACK),
kids = sum(CHILD),
elderly = sum(ELDERLY),
education = sum(EDUC),
married = sum(MARRIED)
) %>% ungroup()
#Not currently grouping properly
cps_data <- cps %>% group_by(CPSID=as.factor(CPSID)) %>%
reframe(
COUNTY = first(COUNTY),
weight = first(HWTFINL),
hhsize = n(),
FSTOTXPNC_perpers = first(FSTOTXPNC)/hhsize, #Different from packet, but needed for summary
FSSTATUS = first(FSSTATUS),
FSSTATUSMD = first(FSSTATUSMD),
FSFOODS = first(FSFOODS),
FSWROUTY = first(FSWROUTY),
FSBAL = first(FSBAL),
FSRAWSCRA = first(FSRAWSCRA),
FSTOTXPNC = first(FSTOTXPNC),
FSSTATUS = first(FSSTATUS),
female = sum(SEX),
hispanic = sum(HISPANIC),
black = sum(BLACK),
kids = sum(CHILD),
elderly = sum(ELDERLY),
education = sum(EDUC),
married = sum(MARRIED)
) %>% ungroup()
#Not currently grouping properly
cps_data <- cps %>% group_by(CPSID=as.factor(CPSID)) %>%
summarise(
COUNTY = first(COUNTY),
weight = first(HWTFINL),
hhsize = n(),
FSTOTXPNC_perpers = first(FSTOTXPNC)/hhsize, #Different from packet, but needed for summary
FSSTATUS = first(FSSTATUS),
FSSTATUSMD = first(FSSTATUSMD),
FSFOODS = first(FSFOODS),
FSWROUTY = first(FSWROUTY),
FSBAL = first(FSBAL),
FSRAWSCRA = first(FSRAWSCRA),
FSTOTXPNC = first(FSTOTXPNC),
FSSTATUS = first(FSSTATUS),
female = sum(SEX),
hispanic = sum(HISPANIC),
black = sum(BLACK),
kids = sum(CHILD),
elderly = sum(ELDERLY),
education = sum(EDUC),
married = sum(MARRIED)
) %>% ungroup()
head(cps_data)
sum(cps_data$hhsize)
cps_data <- cps_data %>%
mutate(FSSTATUS = ifelse(FSSTATUS %in% c(98,99), NA, FSSTATUS),
FSSTATUSMD = ifelse(FSSTATUSMD %in% c(98,99), NA, FSSTATUSMD),
FSFOODS = ifelse(FSFOODS %in% c(98,99), NA, FSFOODS),
FSWROUTY = ifelse(FSWROUTY %in% c(96,97,98,99), NA, FSWROUTY),
FSBAL = ifelse(FSBAL %in% c(96,97,98,99), NA, FSBAL),
FSRAWSCRA = ifelse(FSRAWSCRA %in% c(98,99), NA, FSRAWSCRA),
FSTOTXPNC = ifelse(FSTOTXPNC %in% c(999), NA, FSTOTXPNC)) %>%
mutate(FSSTATUS = ifelse(FSSTATUS > 1, 1, 0),
FSSTATUSMD = ifelse(FSSTATUSMD >1, 1, 0),
FSFOOD = ifelse(FSFOODS > 1, 1, 0),
FSWROUTY = ifelse(FSWROUTY > 1, 1, 0),
FSBAL = ifelse(FSBAL > 1, 1, 0),
FSRAWSCRA = ifelse(FSRAWSCRA >1, 1, 0)
)
haed(cps_data)
head(cps_data)
cps_data <- cps_data %>%
mutate(FSSTATUS = ifelse(FSSTATUS %in% c(98,99), NA, FSSTATUS),
FSSTATUSMD = ifelse(FSSTATUSMD %in% c(98,99), NA, FSSTATUSMD),
FSFOODS = ifelse(FSFOODS %in% c(98,99), NA, FSFOODS),
FSWROUTY = ifelse(FSWROUTY %in% c(96,97,98,99), NA, FSWROUTY),
FSBAL = ifelse(FSBAL %in% c(96,97,98,99), NA, FSBAL),
FSRAWSCRA = ifelse(FSRAWSCRA %in% c(98,99), NA, FSRAWSCRA),
FSTOTXPNC = ifelse(FSTOTXPNC %in% c(999), NA, FSTOTXPNC)) %>%
mutate(FSSTATUS = ifelse(FSSTATUS > 1, 1, 0),
FSSTATUSMD = ifelse(FSSTATUSMD >1, 1, 0),
FSFOOD = ifelse(FSFOODS > 1, 1, 0),
FSWROUTY = ifelse(FSWROUTY > 1, 1, 0),
FSBAL = ifelse(FSBAL > 1, 1, 0),
FSRAWSCRA = ifelse(FSRAWSCRA >1, 1, 0)
)
head(cps_data)
sum(cps_data$hhsize)
rm(list=ls())
library(tidyverse)
library(knitr)
library(tibble)
library(ggthemes)
library(logistf)
library(glmnet)
library(haven)
acs <- read_sas("./data/spm_pu_2022.sas7bdat")
acs <- read_sas("./data/spm_pu_2022.sas7bdat")
acs <- acs %>% filter(st=="19") %>%
group_by(serialno = as.factor(serialno)) %>%
arrange(desc(Sex), desc(Age)) %>%
mutate(weight = first(wt)) %>% select(-wt) %>% ungroup()
acs_data <- acs %>%
mutate(
SEX = Sex-1,
CHILD = ifelse(Age < 18, 1, 0),
ELDERLY = ifelse(Age > 64, 1, 0),
BLACK = ifelse(Race==2, 1, 0),
HISPANIC = ifelse(Hispanic > 0, 1, 0),
EDUC = as.integer(Education %in% c(3,4)),
MARRIED = as.integer(Mar %in% c(1)),
PUMA = as.factor(PUMA)
)
acs_data <- acs %>% group_by(serialno = as.factor(serialno)) %>%
summarise(PUMA = first(PUMA),
hhsize = length(serialno),
female=sum(SEX),
hispanic = sum(HISPANIC),
black = sum(BLACK),
kids = sum(CHILD),
elderly = sum(ELDERLY),
education = sum(EDUC),
married = sum(MARRIED),
weight = weight[1])
acs_data <- acs %>%
mutate(
SEX = Sex-1,
CHILD = ifelse(Age < 18, 1, 0),
ELDERLY = ifelse(Age > 64, 1, 0),
BLACK = ifelse(Race==2, 1, 0),
HISPANIC = ifelse(Hispanic > 0, 1, 0),
EDUC = as.integer(Education %in% c(3,4)),
MARRIED = as.integer(Mar %in% c(1)),
PUMA = as.factor(PUMA)
)
acs_data <- acs %>% group_by(serialno = as.factor(serialno)) %>%
summarise(PUMA = first(PUMA),
hhsize = length(serialno),
female=sum(SEX),
hispanic = sum(HISPANIC),
black = sum(BLACK),
kids = sum(CHILD),
elderly = sum(ELDERLY),
education = sum(EDUC),
married = sum(MARRIED),
weight = weight[1])
head(acs_data)
colnames(acs_data)
acs_data$SEX
table(acs_data$SEX)
acs_data <- acs %>% group_by(serialno = as.factor(serialno)) %>%
summarise(PUMA = first(PUMA),
hhsize = length(serialno),
female = sum(SEX),
hispanic = sum(HISPANIC),
black = sum(BLACK),
kids = sum(CHILD),
elderly = sum(ELDERLY),
education = sum(EDUC),
married = sum(MARRIED),
weight = weight[1])
acs_data <- acs_data %>% group_by(serialno = as.factor(serialno)) %>%
summarise(PUMA = first(PUMA),
hhsize = length(serialno),
female = sum(SEX),
hispanic = sum(HISPANIC),
black = sum(BLACK),
kids = sum(CHILD),
elderly = sum(ELDERLY),
education = sum(EDUC),
married = sum(MARRIED),
weight = weight[1])
head(acs_data)
map_chr(acs, ~attr(.x, "label")) %>%
bind_cols(names=names(acs), question = .) %>%
rownames_to_column(var="Variable Name") %>% kable
source("C:/Users/mattc/Desktop/FA24/STAT172Final/clean_cps.R")
ggplot(data=cps_data, aes(x=kids, y=hhsize)) +
geom_count(aes(color=after_stat(n)))
ggplot(data=cps_data) +
geom_point(aes(x=elderly, y=FSTOTXPNC_perpers))
nrow(cps_data)
nrow(cps_data[cps_data$kids == 0])
nrow(cps_data[cps_data$kids == 0,])
ggplot(data=cps_data[cps_data$kids==0,]) +
geom_point(aes(x=hhsize, y=FSTOTXPNC_perpers))
source("C:/Users/mattc/Desktop/FA24/STAT172Final/clean_cps.R")
ggplot(data=cps_data[cps_data$kids==0,]) +
geom_point(aes(x=hhsize, y=FSTOTXPNC_perpers),)
ggplot(data=cps_data[cps_data$kids==0,]) +
geom_point(aes(x=hhsize, y=FSTOTXPNC_perpers),)
ggplot(data=cps_data[cps_data$kids==0 && !is.na(cps_data$FSTOTXPNC),]) +
geom_point(aes(x=hhsize, y=FSTOTXPNC_perpers),)
ggplot(data=cps_data[(cps_data$kids==0 && !is.na(cps_data$FSTOTXPNC)),]) +
geom_point(aes(x=hhsize, y=FSTOTXPNC_perpers),)
ggplot(data=filter(cps_data, kids=0 & !is.na(FSTOTXPNC))) +
geom_point(aes(x=hhsize, y=FSTOTXPNC_perpers),)
ggplot(data=filter(cps_data, kids==0 & !is.na(FSTOTXPNC))) +
geom_point(aes(x=hhsize, y=FSTOTXPNC_perpers),)
source("C:/Users/mattc/Desktop/FA24/STAT172Final/clean_cps.R")
ggplot(data=cps_data) +
geom_point(aes(x=hhsize, y=FSTOTXPNC_perpers),)
ggplot(data=filter(cps_data, kids==0)) +
geom_point(aes(x=hhsize, y=FSTOTXPNC_perpers),)
ggplot(data=filter(cps_data, kids==0)) +
geom_point(aes(x=hhsize, y=FSTOTXPNC),)
table(cps_data$FSTOTXPNC)
clear
source("C:/Users/mattc/Desktop/FA24/STAT172Final/clean_acs.R")
str(acs_data)
source("C:/Users/mattc/Desktop/FA24/STAT172Final/clean_cps.R")
summary(cps_data$FSSTATUS)
ggplot(data=cps_data) +
geom_point(aes(x=hhsize, y=FSTOTXPNC_perpers))
ggplot(data=filter(cps_data, kids==0)) +
geom_point(aes(x=hhsize, y=FSTOTXPNC_perpers))
sumarry(cps)
summary(cps)
summary(cps$FSSTMPVALC)
ggplot(data=cps) + geom_histogram(aes(x=FSSTMPVALC))
table(cps$FSSTMPVALC)
ggplot(data=filter(cps, FSSTMPVALC!=999)) + geom_histogram(aes(x=FSSTMPVALC))
nrow(cps[cps$FSSTMPVALC!=999,])
filter(cps_data, elderly > 0)
nrow(filter(cps_data, elderly > 0))
nrow(cps_data)
cps_data
summary(cps_data)
cps$DIFFANY
source("C:/Users/mattc/Desktop/FA24/STAT172Final/clean_cps.R")
summary(cps_data)
m1 = glm(FSWROUTY ~ hhsize + married + education + elderly + kids + black + hispanic + female,
data=cps_data,
weights = weight,
family = binomial(link="logit"))
m0 = glm(FSWROUTY ~ 1,
data=cps_data,
weights = weight,
family = binomial(link="logit"))
step(m0, scope=list(lower = m0, upper=m1, direction="both"))
#FORWARD REGRESSION (IMPROVE):
remove_na = filter(cps_data, !is.na(cps_data$FSWROUTY))
m1 = glm(FSWROUTY ~ hhsize + married + education + elderly + kids + black + hispanic + female,
data=remove_na,
weights = weight,
family = binomial(link="logit"))
m0 = glm(FSWROUTY ~ 1,
data=remove_na,
weights = weight,
family = binomial(link="logit"))
step(m0, scope=list(lower = m0, upper=m1, direction="both"))
v1 = step(m0, scope=list(lower = m0, upper=m1, direction="both"))
summary(v1)
summary(m1)
source("C:/Users/mattc/Desktop/FA24/STAT172Final/clean_cps.R")
source("C:/Users/mattc/Desktop/FA24/STAT172Final/clean_cps.R")
source("C:/Users/mattc/Desktop/FA24/STAT172Final/clean_cps.R")
summary(cps_data$FSSTMPVALC)
ggplot(data=cps_data) + geom_histogram(aes(x=FSSTMPVALC))
